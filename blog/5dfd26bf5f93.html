<!DOCTYPE html><html lang=""><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Chenrt"><meta name="keywords" content="Chenrt, @Chenrt, Chenrt Blog, 计算机, 网络安全, 博客, 个人网站"><meta name="description" content="Chenrt 的个人博客"><meta name="generator" content="Hexo"><link rel="icon" href="/favicon.svg"><title>Chenrt の 小窝 - 网络攻防技术实验作业 | 综合实践篇</title><script defer="defer" src="/js/chunk-vendors.js"></script><script defer="defer" src="/js/app.js"></script><link href="/css/chunk-vendors.css" rel="stylesheet"><link href="/css/app.css" rel="stylesheet"></head><body><noscript><header><nav><a href="/">Home</a></nav><nav><a href="/blogs/1">Blogs</a></nav><nav><a href="/category">Categories</a></nav><nav><a href="/tag">Tags</a></nav><nav><a href="/archive">Archives</a></nav><nav><a href="/about">About</a></nav><nav><a href="/apis">Api</a></nav></header><div><br></div><content><div><a href="/blog/5dfd26bf5f93"><h1>网络攻防技术实验作业 | 综合实践篇</h1></a><div><div><div><a href="/category/Buaa/1">Buaa</a></div><div><a href="/category/Buaa/Security/1">Security</a></div></div></div><div><div><div><a href="/tag/SQL/1">SQL</a></div><div><a href="/tag/Trojan/1">Trojan</a></div></div></div><div><p>[迁移自博客园] | BUAA Web Attack and Defense 2022 Integrated Practice</p><span id="more"></span><h2 id="通过-sql-注入获得用户及密码"><a class="markdownIt-Anchor" href="#通过-sql-注入获得用户及密码"></a> 通过 SQL 注入获得用户及密码</h2><p>采用 Windows7 中的 DVMA 靶场，通过 PHPStudy 部署：</p><img src="/assets/images/buaa-security/sql/config.png" width="90%"><h3 id="简单难度的-sql-注入"><a class="markdownIt-Anchor" href="#简单难度的-sql-注入"></a> 简单难度的 SQL 注入</h3><p>配置如下图所示：</p><img src="/assets/images/buaa-security/sql/low-1.png" width="85%"><p>简单测试，发现是通过 ID 查用户：</p><img src="/assets/images/buaa-security/sql/low-2.png" width="85%"><p>追加字符 <code>'</code>，报错如下，怀疑存在字符型注入：</p><img src="/assets/images/buaa-security/sql/low-3.png" width="85%"><p>输入 <code>1' and '1'='1</code> 查询正常，输入 <code>1' and '1'='2</code> 无回显，确认存在字符型注入：</p><img src="/assets/images/buaa-security/sql/low-4.png" width="85%"> <img src="/assets/images/buaa-security/sql/low-5.png" width="85%"><p>依次尝试 <code>1' union select 1 #</code>、<code>1' union select 1, 2 #</code> 等，确认查询存在两个字段（此处亦可通过尝试 <code>1' order by 1 #</code>、<code>1' order by 2 #</code> 等的方式获取字段数）：</p><img src="/assets/images/buaa-security/sql/low-6.png" width="85%"><p>通过 <code>0' union select schema_name, 1 from information_schema.schemata #</code> 拿到库名：</p><img src="/assets/images/buaa-security/sql/low-7.png" width="85%"><p>通过 <code>0' union select column_name, 1 from information_schema.columns where table_name = 'users' #</code> 拿到 users 表列名：</p><img src="/assets/images/buaa-security/sql/low-8.png" width="85%"><p>通过 <code>0' union select user, password from users #</code> 拿到全部用户的账号密码：</p><img src="/assets/images/buaa-security/sql/low-9.png" width="85%"><p>根据长度猜测密码经过 MD5 哈希，MD5 已被证实不安全，随便找一个在线工具即可解密：</p><img src="/assets/images/buaa-security/sql/low-10.png" width="85%"><h3 id="中等难度的-sql-注入"><a class="markdownIt-Anchor" href="#中等难度的-sql-注入"></a> 中等难度的 SQL 注入</h3><p>配置如下图所示：</p><img src="/assets/images/buaa-security/sql/mid-1.png" width="85%"><p>简单测试，发现是通过 ID 查用户，只不过由输入变成了选择：</p><img src="/assets/images/buaa-security/sql/mid-2.png" width="85%"><p>自然想到这不过是个前端验证，约等于没有验证，直接抓包：</p><img src="/assets/images/buaa-security/sql/mid-3.png" width="85%"><p>使用和简单难度一样的 payload 即 <code>0' union select user, password from users #</code> 注入，先 URL 编码一次：</p><img src="/assets/images/buaa-security/sql/mid-4.png" width="85%"><p>发现报错如下，猜测后端存在转义，查看源代码发现单引号在 <code>mysql_real_escape_string</code> 中被转义，且变为数字型注入：</p><img src="/assets/images/buaa-security/sql/mid-5.png" width="85%"> <img src="/assets/images/buaa-security/sql/mid-6.png" width="85%"><p>只要将 payload 修改为 <code>0 union select user, password from users #</code> 即可，同样先 URL 编码一次，账号密码到手：</p><img src="/assets/images/buaa-security/sql/mid-7.png" width="85%"><h3 id="复杂难度的-sql-注入"><a class="markdownIt-Anchor" href="#复杂难度的-sql-注入"></a> 复杂难度的 SQL 注入</h3><p>配置如下图所示：</p><img src="/assets/images/buaa-security/sql/high-1.png" width="85%"><p>简单测试，发现是通过 ID 查用户，只不过变成了在弹窗里面输入：</p><img src="/assets/images/buaa-security/sql/high-2.png" width="85%"><p>使用简单难度下的 payload 测试，直接注入成功拿到账号密码：</p><img src="/assets/images/buaa-security/sql/high-3.png" width="85%"><p>查看了一下源代码，发现增加了 <code>limit 1</code>，但被注入 payload 的结尾注释掉了，猜测 <code>limit 1</code> 的目的是卡没有使用注释，而是使用引号闭合的方式进行的注入（但其实也可以通过多次 <code>offset</code> 的方式绕过）：</p><img src="/assets/images/buaa-security/sql/high-4.png" width="85%"><h3 id="无解难度的-sql-注入"><a class="markdownIt-Anchor" href="#无解难度的-sql-注入"></a> 无解难度的 SQL 注入</h3><p>配置如下图所示：</p><img src="/assets/images/buaa-security/sql/hell-1.png" width="85%"><p>查看源代码，发现通过预编译的方式杜绝了 SQL 注入的可能：</p><img src="/assets/images/buaa-security/sql/hell-2.png" width="85%"><h2 id="冰河木马使用及清除实验"><a class="markdownIt-Anchor" href="#冰河木马使用及清除实验"></a> 冰河木马使用及清除实验</h2><ul><li>攻击主机：Windows7 x64 虚拟机，NAT 模式联网。</li><li>被攻击主机：WindowsXP x86 虚拟机，NAT 模式联网。</li></ul><h3 id="实验前组网测试"><a class="markdownIt-Anchor" href="#实验前组网测试"></a> 实验前组网测试</h3><p>攻击主机 IP 地址及攻击主机 ping 被攻击主机：</p><img src="/assets/images/buaa-security/ice/config-1.png" width="90%"><p>被攻击主机 IP 地址及攻击主机 ping 攻击主机：</p><img src="/assets/images/buaa-security/ice/config-2.png" width="90%"><h3 id="使用冰河木马"><a class="markdownIt-Anchor" href="#使用冰河木马"></a> 使用冰河木马</h3><p>被攻击主机运行 <code>g_server</code>，出现 <code>Kernel32.exe</code> 进程表明启动成功：</p><img src="/assets/images/buaa-security/ice/use-1.png" width="85%"><p>攻击主机运行 <code>g_client</code> 并在局域网扫描，发现被攻击主机：</p><img src="/assets/images/buaa-security/ice/use-2.png" width="85%"><p>攻击主机查看被攻击主机的文件系统：</p><img src="/assets/images/buaa-security/ice/use-3.png" width="85%"><p>攻击主机向被攻击主机发消息：</p><img src="/assets/images/buaa-security/ice/use-4.png" width="85%"><p>被攻击主机弹出攻击主机发送的消息：</p><img src="/assets/images/buaa-security/ice/use-5.png" width="85%"><h3 id="清除冰河木马"><a class="markdownIt-Anchor" href="#清除冰河木马"></a> 清除冰河木马</h3><p>在被攻击主机上结束删除 <code>Kernel32.exe</code> 进程，并删除 <code>C:\Window\system32\Kernel32.exe</code> 和 <code>C:\Window\system32\Sysexplr.exe</code>：</p><img src="/assets/images/buaa-security/ice/remove-1.png" width="85%"><p>在注册表 <code>HKEY LOCAL_ MACHINE\software\microsoft\windows\Currentversion\Run</code> 中删除 <code>Kernel32.exe</code> 对应的表项：</p><img src="/assets/images/buaa-security/ice/remove-2.png" width="85%"><p>在注册表 <code>HKEY LOCAL_ MACHINE\software\microsoft\windows\Currentversion\Runservices</code> 中删除 <code>Kernel32.exe</code> 对应的表项：</p><img src="/assets/images/buaa-security/ice/remove-3.png" width="85%"><p>将注册表 <code>HKEY/CLASSES/ROOT/txtfile/shell/open/command</code> 中 <code>C:/windows/system/Sysexplr.exe %1</code> 改回 <code>C:/windows/notepad.exe %1</code>：</p><img src="/assets/images/buaa-security/ice/remove-4.png" width="85%"> <img src="/assets/images/buaa-security/ice/remove-5.png" width="85%"><p>在攻击主机上尝试连接，由于被攻击主机上的木马被清除，连接失败：</p><img src="/assets/images/buaa-security/ice/remove-6.png" width="85%"></div><div>Word count: 890</div><div>Reading time: 4min</div><div><div><a href="/archive/2022/05/1">Created 2022-05-28T13:32:01.000Z</a></div></div><div><div><a href="/archive/2022/05/1">Last Modified 2022-05-28T13:32:01.000Z</a></div></div><div><br><br></div></div></content><div><br></div><footer>Copyright © 2021-2023 Chenrt Blog</footer></noscript><div id="app"></div></body></html>